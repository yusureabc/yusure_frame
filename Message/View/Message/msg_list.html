<?php include_once( VIEW_PATH . 'Public/head.html' ); ?>

<div class="doc-example">
    <ul id="ul_msglist" class="am-comments-list am-comments-list-flip">
        <li class="am-comment">
        <a href="#link-to-user-home">
        <img src="http://s.amazeui.org/media/i/demos/bw-2014-06-19.jpg?imageView/1/w/96/h/96" alt="" class="am-comment-avatar" width="48" height="48"></a>
        <div class="am-comment-main">
            <header class="am-comment-hd">
            <div class="am-comment-meta">
                <a href="#link-to-user" class="am-comment-author">某人</a> 发表留言 <time datetime="2013-07-27T04:54:29-07:00" title="2013年7月27日 下午7:54 格林尼治标准时间+0800">2014-7-12 15:30</time>
            </div>
            </header>
            <div class="am-comment-bd">
                <p>
                    那，那是一封写给南部母亲的信。我茫然站在骑楼下，我又看到永远的樱子走到街心。其实雨下得并不大，却是一生一世中最大的一场雨。而那封信是这样写的，年轻的樱子知不知道呢？
                </p>
                <blockquote>
                    <a href="#link-to-user" class="am-comment-author">Yusure</a>
                    <a href="#lin-to-user">@某人</a>
                    我打算在下个月和樱子结婚。
                    <a href=""><i class="am-icon-reply"></i>回复</a>
                </blockquote>
            </div>
            <footer class="am-comment-footer">
                <div class="am-comment-actions">
                <a href=""><i class="am-icon-reply"></i>回复</a>
                </div>
            </footer>
        </div>
        </li>
        <?php foreach ( (array)$msg_list as $k => $v ) { ?>
        <li class="am-comment">
        <a href="#link-to-user-home">
        <img src="<?php echo $v['avatar']; ?>" alt="" class="am-comment-avatar" width="48" height="48"></a>
        <div class="am-comment-main">
            <header class="am-comment-hd">
            <div class="am-comment-meta">                
                <a href="#link-to-user" class="am-comment-author"> <?php echo $v['username']; ?> </a> 发表留言 <time datetime="<?php echo $v['datetime']; ?>" title="<?php echo $v['datetime']; ?>"> <?php echo $v['datetime']; ?> </time>
            </div>
            </header>
            <div class="am-comment-bd">
                <p> <?php echo $v['content']; ?> </p>
                <!-- <blockquote>
                    <a href="#link-to-user" class="am-comment-author">Yusure</a>
                    <a href="#lin-to-user">@某人</a>
                    我打算在下个月和樱子结婚。
                    <a href=""><i class="am-icon-reply"></i>回复</a>
                </blockquote> -->
            </div>
            <footer class="am-comment-footer">
                <div class="am-comment-actions">
                <a href=""><i class="am-icon-reply"></i>回复</a>
                </div>
            </footer>
        </div>
        </li>
        <?php } ?>
    </ul>
</div>
<span class="am-form">
<a href="#link-to-user-home">
   <img src="<?php echo $_SESSION['user']['avatar']; ?>" alt="" class="am-comment-avatar" width="48" height="48">
</a>
<fieldset>
    <div class="am-form-group">
      <label for="doc-ta-1">请输入您的留言</label>
      <textarea class="" rows="5" id="msg_content"></textarea>
    </div>
    <p><button type="submit" id="submit_msg" class="am-btn am-btn-default">提交</button></p>
</fieldset>
</span>

<span id="am_alert"></span>

<script type="text/javascript">
$(function(){
    $('#submit_msg').click( function() {
        var url = "<?php echo get_url( 'Message/add_msg' ); ?>";
        var content = $('#msg_content').val().trim();
        var data = {
            'content': content,
        };
        var avatar = "<?php echo session( 'user.avatar' ); ?>";
        var username = "<?php echo session( 'user.username' ); ?>";
        var datetime = "<?php echo date( 'Y-m-d H:i', NOW_TIME ); ?>";
        $.ajax({
            'url': url,
            'type': 'post',
            'data': data,
            'dataType': 'json',
            success: function ( msg ) {
                am_alert( '', msg['info'] );
                if ( msg['status'] )
                {
                    /* TODO 追加html */
                    var msg_html = add_msg( avatar, username, datetime, content );
                    $('#ul_msglist > li:first').before( msg_html );
                    $('#msg_content').val( '' );
                }
            },
            error: function () {
                alert( '网络错误' );
            }
        });
    });
});
    
</script>
<?php include_once( VIEW_PATH . 'Public/foot.html' ); ?>